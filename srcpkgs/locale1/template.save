# Template file for 'org.freedesktop.locale1'
pkgname=locale1
version=1
revision=3
wrksrc="${pkgname}-${version}"
depends="python3-dbus-next"
short_desc="TODO: pop-fonts short_desc"
maintainer="Bella Wagner <belladev109@proton.me>"
license="GPL-3.0-only"
homepage="https://www.freedesktop.org/software/systemd/man/latest/org.freedesktop.locale1.html"

pre_install() {
	if [ ! -d $wrksrc ]; then
		mkdir $wrksrc
	fi
	cd $wrksrc
	cat > locale1 <<EOF
#!/usr/bin/env python3
import os
import asyncio
from dbus_fast.service import ServiceInterface, method, dbus_property, PropertyAccess

EOF

cat > locale1-stub.conf <<EOF
<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">

<busconfig>
  <policy user="root">
    <allow own="org.freedesktop.locale1"/>
  </policy>
  <policy context="default">
    <allow send_destination="org.freedesktop.locale1"/>
    <allow receive_sender="org.freedesktop.locale1"/>
  </policy>
</busconfig>

EOF
}

do_install() {
	vmkdir usr/bin
	vinstall locale1 755 /usr/bin
	vinstall locale1-stub.conf 755 /etc/dbus-1/system.d
	vsv locale1
}
